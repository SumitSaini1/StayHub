<% layout("layouts/boilerplatecode") -%>

  <div class="row">
    <div class="col-8 offset-2">
      <div class="card rounded shadow-sm" id="show-card">
        <h2 class="show-heading text-primary">
          <%= data.title %>
        </h2>
        <img src="<%= data.image.url %>" class="card-img-top show-img" alt="Image" />

        <div class="card-body">
          <i><b>Owner:</b></i> <i>
            <%= data.owner.username %>
          </i>
          <br>
          <span><b>Category:</b> <%= data.category || "No category" %></span>

          <p>
            <%= data.description %>
          </p>
          <p>&#8377; <%= data.price.toLocaleString("en-IN") %>
          </p>
          <p>
            <%= data.location %>, <%= data.country %>
          </p>

          <% if(currUser && currUser._id.equals(data.owner._id)){ %>
            <div class="show-card-actions">
              <form action="/listening/<%= data._id %>/edit" method="GET">
                <button class="btn btn-primary">Edit</button>
              </form>
              <form action="/showList/<%= data._id %>?_method=DELETE" method="POST">
                <button class="btn btn-danger">Delete</button>
              </form>
            </div>
            <% } %>



              <hr>

              <h5 class="text-primary">Leave a Review</h5>

              <form action="/showList/<%= data._id %>/review" method="POST" novalidate class="needs-validation">

                <fieldset class="starability-slot">
                  <legend>Rating:</legend>

                  <input type="radio" id="first-rate1" name="Review[rating]" value="1">
                  <label for="first-rate1" title="Terrible">1 star</label>

                  <input type="radio" id="first-rate2" name="Review[rating]" value="2">
                  <label for="first-rate2" title="Not good">2 stars</label>

                  <input type="radio" id="first-rate3" name="Review[rating]" value="3" checked>
                  <label for="first-rate3" title="Average">3 stars</label>

                  <input type="radio" id="first-rate4" name="Review[rating]" value="4">
                  <label for="first-rate4" title="Very good">4 stars</label>

                  <input type="radio" id="first-rate5" name="Review[rating]" value="5">
                  <label for="first-rate5" title="Amazing">5 stars</label>
                </fieldset>

                <label for="comment" class="mt-2">Comment</label>
                <textarea name="Review[comment]" id="comment" rows="4" class="form-control"
                  placeholder="Write a review..." required></textarea>

                <button type="submit" class="btn btn-success mt-2">Submit</button>
              </form>





              <hr>

              <h5>All Reviews</h5>
              <div class="container mt-4">
                <div class="row">
                  <% if (data.reviews.length> 0) { %>
                    <% data.reviews.forEach(review=> { %>
                      <div class="col-md-6 col-sm-12 mb-3">
                        <div class="card shadow-sm h-100">
                          <p><b>Author_@:</b><span><i>
                                <%= review.author.username %>
                              </i></span></p>
                          <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                              <h6>‚≠ê Rating: <%= review.rating %>/5</h6>
                              <p class="starability-result" data-rating="<%= review.rating %>">

                              </p>
                              <p>
                                <%= review.comment %>
                              </p>
                              <p class="text-muted small">
                                <%= new Date(review.createdAt).toLocaleString() %>
                              </p>
                            </div>

                            <!-- Delete button -->


                            <form action="/showList/<%= data._id %>/review/<%= review._id %>?_method=DELETE"
                              method="POST" class="mt-2">
                              <button type="submit" class="btn btn-sm btn-danger w-100">
                                üóë Delete
                              </button>
                            </form>


                          </div>
                        </div>
                      </div>
                      <% }) %>
                        <% } else { %>
                          <div class="col-12 text-center">
                            <p class="text-muted">No reviews yet. Be the first to add one!</p>
                          </div>
                          <% } %>
                </div>
              </div>

        </div>
      </div>
    </div>
  </div>

  <script>
    const rangeInput = document.getElementById('rating');
    const rangeOutput = document.getElementById('rangeValue');
    rangeOutput.textContent = rangeInput.value;
    rangeInput.addEventListener('input', () => {
      rangeOutput.textContent = rangeInput.value;
    });
  </script>